@model IEnumerable<JanuaryProject.Models.Painting>
@{
    ViewBag.Title = "Art Gallery";
}

<style>
    .gallery-container {
        padding: 40px;
        max-width: 1200px;
        margin: 0 auto;
    }

    .gallery-title {
        text-align: center;
        font-size: 2rem;
        margin-bottom: 40px;
    }

    .gallery-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        grid-auto-rows: auto;
        gap: 20px;
    }

    .painting-item {
        position: relative;
        cursor: pointer;
        transition: transform 0.3s ease;
    }

        .painting-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border: 5px solid #000;
        }

        .painting-item:hover {
            transform: scale(1.02);
        }

    /* Modal styles */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        z-index: 1000;
    }

    .modal-content {
        position: relative;
        background-color: white;
        margin: 5% auto;
        padding: 20px;
        width: 80%;
        max-width: 800px;
        border-radius: 8px;
    }

    .close-modal {
        position: absolute;
        right: 20px;
        top: 10px;
        font-size: 28px;
        cursor: pointer;
    }

    .modal-body {
        display: flex;
        gap: 20px;
        margin-top: 20px;
    }

    .modal-image {
        width: 50%;
    }

        .modal-image img {
            width: 100%;
            height: auto;
            border: 2px solid #000;
        }

    .modal-details {
        width: 50%;
    }

    .artist-link {
        color: #0066cc;
        text-decoration: none;
    }

        .artist-link:hover {
            text-decoration: underline;
        }

    .add-to-cart-btn {
        width: 100%;
        padding: 10px;
        background-color: #0066cc;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.2s;
    }

        .add-to-cart-btn:hover {
            background-color: #0052a3;
        }
</style>

<div class="gallery-container">
    <h2 class="gallery-title">Welcome to Muse Market's Gallery</h2>
    <div class="gallery-grid">
        @foreach (var painting in Model)
        {
            <div class="painting-item"
                 data-id="@painting.PaintingId"
                 data-name="@painting.Name"
                 data-description="@painting.Description"
                 data-dimensions="@painting.Dimensions"
                 data-price="@painting.Price.ToString("F2")"
                 data-artist-name="@painting.Artist.Name"
                 data-artist-lastname="@painting.Artist.LastName"
                 data-artist-id="@painting.Artist.Id"
                 data-image="@painting.ImageUrl"
                 onclick="showModal(this)">
                <img src="@painting.ImageUrl" alt="@painting.Name">
            </div>
        }
    </div>
</div>

<div id="paintingModal" class="modal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeModal()">&times;</span>
        <div class="modal-body">
            <div class="modal-image">
                <img id="modalImage" src="" alt="">
            </div>
            <div class="modal-details">
                <h3 id="modalTitle" style="font-size: 1.5rem; margin-bottom: 15px;"></h3>
                <p id="modalDescription" style="margin-bottom: 15px;"></p>
                <p id="modalDimensions" style="margin-bottom: 10px;"></p>
                <p style="margin-bottom: 10px;">
                    Artist: <a href="#" id="artistLink" class="artist-link"></a>
                </p>
                <p id="modalPrice" style="font-size: 1.2rem; font-weight: bold; margin-bottom: 20px;"></p>
                @if (User.Identity.IsAuthenticated && User.IsInRole("Customer"))
                {
                    <form id="addToCartForm" method="post">
                        @Html.AntiForgeryToken()
                        <button type="submit" class="add-to-cart-btn">Add to Cart</button>
                    </form>
                }
            </div>
        </div>
    </div>
</div>

<script>
    function showModal(element) {
        const modal = document.getElementById('paintingModal');
        const modalImage = document.getElementById('modalImage');
        const modalTitle = document.getElementById('modalTitle');
        const modalDescription = document.getElementById('modalDescription');
        const modalDimensions = document.getElementById('modalDimensions');
        const artistLink = document.getElementById('artistLink');
        const modalPrice = document.getElementById('modalPrice');
        const addToCartForm = document.getElementById('addToCartForm');

        modalImage.src = element.dataset.image;
        modalTitle.textContent = element.dataset.name;
        modalDescription.textContent = element.dataset.description;
        modalDimensions.textContent = `Dimensions: ${element.dataset.dimensions}`;

        // Update artist link
        artistLink.textContent = `${element.dataset.artistName} ${element.dataset.artistLastname}`;
        artistLink.href = `/Artists/Details/${element.dataset.artistId}`;

        modalPrice.textContent = new Intl.NumberFormat('en-US', {
            style: 'currency',
            currency: 'USD'
        }).format(parseFloat(element.dataset.price));

        if (addToCartForm) {
            addToCartForm.action = `/Carts/AddToCart?paintingId=${element.dataset.id}`;
        }

        modal.style.display = 'block';
    }

    function closeModal() {
        const modal = document.getElementById('paintingModal');
        modal.style.display = 'none';
    }

    // Close modal when clicking outside
    window.onclick = function (event) {
        const modal = document.getElementById('paintingModal');
        if (event.target == modal) {
            closeModal();
        }
    }
</script>